name: Lint Changed Files

on: [push, pull_request]

jobs:
  changed_files:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v2
        with:
          fetch-depth: 0

      - name: Get list of added and modified files
        id: changed-files
        uses: tj-actions/changed-files@v39

      - name: Echo changed files
        run: |
          echo "Changed Files: ${{ steps.changed-files.outputs.all_changed_files }}" 

  lint:
    needs: [changed_files]
    runs-on: ubuntu-latest
    steps:
    - name: Lint Python scripts
      if: endsWith(needs.changed_files.outputs.all_changed_files, '.py')
      run: |
        pip install flake8
        echo "${{ needs.changed_files.outputs.all_changed_files }}" | tr ' ' '\n' | grep \\.py$ | xargs flake8

    - name: Lint shell scripts
      if: endsWith(needs.changed_files.outputs.all_changed_files, '.sh')
      run: |
        sudo apt-get install shellcheck
        echo "${{ needs.changed_files.outputs.all_changed_files }}" | tr ' ' '\n' | grep \\.sh$ | xargs shellcheck

    - name: Lint YAML files
      if: endsWith(needs.changed_files.outputs.all_changed_files, 'yaml')
      run: |
        pip install yamllint
        echo "${{ needs.changed_files.outputs.all_changed_files }}" | tr ' ' '\n' | grep \\.y[a]?ml$ | xargs yamllint

