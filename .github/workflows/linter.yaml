name: Lint Changed Files

on: [push, pull_request]

jobs:
  changed_files:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v2
        with:
          fetch-depth: 0

      - name: Get list of added and modified files
        id: changed-files
        uses: tj-actions/changed-files@v39
        with:
          files: |
            *.sh
            *.yml
            *.yaml
            *.py
  lint:
    runs-on: ubuntu-latest
    steps:
      - name: Lint Python scripts
        run: |
          pip install flake8
          for file in ${{ needs.changed_files.outputs.changed-files }}; do
            [[ "$file" == *.py ]] && flake8 "$file"
          done

      - name: Lint shell scripts
        run: |
          sudo apt-get install shellcheck
          for file in ${{ needs.changed_files.outputs.changed-files }}; do
            [[ "$file" == *.sh ]] && shellcheck "$file"
          done

      - name: Lint YAML files
        run: |
          pip install yamllint
          for file in ${{ needs.changed_files.outputs.changed-files }}; do
            [[ "$file" == *.yaml || "$file" == *.yml ]] && yamllint "$file"
          done
